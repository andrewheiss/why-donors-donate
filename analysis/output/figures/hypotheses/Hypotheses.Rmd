---
title: "Hypotheses"
author: "Andrew Heiss, Marc Dotson, and Suparna Chaudhry"
date: "Last run: `r format(Sys.time(), '%F')`"
output: 
  html_document:
    code_folding: hide
    pandoc_args:
      - "--default-image-extension=png"
editor_options: 
  chunk_output_type: console
---
In this study, we simultaneously account for the interaction between legal crackdown, issue area, funding source, and managerial practices as well as donor characteristics. We hypothesize that each of these structural and organizational characteristics will have a significant effect on donor behavior, but we’re unsure of the direction of that effect.

```{r load-packages, warning = FALSE, message = FALSE, echo = FALSE}
library(tidyverse)
library(donorheuristics)
library(rstan)
library(bayesplot)
library(tidybayes)
library(bayesm)
library(ggridges)
library(ggraph)
library(ggdag)
library(here)
```


```{r plot-marginals, echo = FALSE}
# Specify the covariate.
intercept <- 0                            # Intercept-only
public_affairs <- 0                       # Public affairs
political_ideology <- 0                   # Political ideology
social_views <- 0                         # Social views
charity_voluntarism <- 0                  # Charity and voluntarism
demographics <- 0                         # Demographics
public_political <- 0                     # Public affairs + Political ideology
public_political_social <- 0              # + Social views
public_political_social_charity <- 0      # + Charity and voluntarism
public_political_social_charity_demo <- 1 # + Demographics

# Load draws
if (intercept == 1) draws <- read_rds(here::here("analysis", "output", "posterior_draws", "intercept_noncentered.rds"))
if (public_affairs == 1) draws <- read_rds(here::here("analysis", "output", "posterior_draws", "public_affairs.rds"))
if (political_ideology == 1) draws <- read_rds(here::here("analysis", "output", "posterior_draws", "political_ideology.rds"))
if (social_views == 1) draws <- read_rds(here::here("analysis", "output", "posterior_draws", "social_views.rds"))
if (charity_voluntarism == 1) draws <- read_rds(here::here("analysis", "output", "posterior_draws", "charity_voluntarism.rds"))
if (demographics == 1) draws <- read_rds(here::here("analysis", "output", "posterior_draws", "demographics.rds"))
if (public_political == 1) draws <- read_rds(here::here("analysis", "output", "posterior_draws", "public_political.rds"))
if (public_political_social == 1) draws <- read_rds(here::here("analysis", "output", "posterior_draws", "public_political_social.rds"))
if (public_political_social_charity == 1) draws <- read_rds(here::here("analysis", "output", "posterior_draws", "public_political_social_charity.rds"))
if (public_political_social_charity_demo == 1) draws <- read_rds(here::here("analysis", "output", "posterior_draws", "public_political_social_charity_demo.rds"))

# Name labels
level_labels <- c(
  str_c("Organization: ", c("Amnesty International", "Greenpeace", "Oxfam", "Red Cross")),
  str_c("Issue area: ", c("Environment", "Human rights", "Refugee relief")),
  "Financial transparency: Yes",
  "Accountability: Yes",
  str_c("Funding sources: ", c("Handful of wealthy private donors", "Government grants")),
  str_c("Relationship with host government: ", c("Criticized", "Under crackdown"))
)

# Name covariates
if (public_affairs == 1) {
  covariate_labels <- c(
    "Follow national news: Multiple times a day to Never", "Follow international news: Always to Never", 
    str_c(
      "Medium to follow news: ", 
      c("TV", "Print", "Online (excluding social media)", "Social media", "Radio", "Email newsletters", "News app")
    ),
    "Follow government and public affairs: Most of the time to Hardly at all", "Traveled to a developing country: No"
  )
}
if (political_ideology == 1) {
  covariate_labels <- c(
    "Liberal to Conservative"
  )
}
if (social_views == 1) {
  covariate_labels <- c(
    "Trust in political institutions: None to Complete", "People should be more charitable: Agree to Disagree",
    "Religious and worship service attendance: Multiple times a week to Never", "Importance of religion: Extremely to Not at all",
    str_c(
      "Religion: ", 
      c("Protestant", "Christian Orthodox", "Jewish", "Muslim", "Sikh", "Hindu", "Buddhist", "Atheist", "Other")
    )
  )
}
if (charity_voluntarism == 1) {
  covariate_labels <- c(
    "Importance of trusing charities: Not at all to Essential", "Trust in charities: None to Complete", "Donation frequency: Weekly to Never",
    "Donated last year: $1-$49 to $10,000 or more", "Volunteered in past 12 months: No", "Volunteer frequency: Weekly to Every few years",
    "History of activism: Extreme to Never", "History of family activism: Extreme to Never", 
    str_c(
      c(
        "Church or religious organization: ", "Sport or recreational organization: ", "Art, music, or educational organization: ",
        "Labor union: ", "Political party: ", "Environmental organization: ", "Professional association: ", 
        "Humanitarian or charitable organization: ", "Consumer organization: ", "Other organization: "
      ), 
      "Member to Not"
    )
  )
}
if (demographics == 1) {
  covariate_labels <- c(
    str_c(
      "Gender: ", 
      c("Female", "Transgender", "Prefer not to say", "Other")
    ), 
    str_c(
      "Marital status: ", 
      c("Widowed", "Divorced", "Separated", "Never married")
    ), 
    "Education: Less than high school to Doctorate",
    "Income: Less than $10,000 to $300,000 or more",
    str_c(
      "Race/ethnicity: ", 
      c("White", "Black or African American", "American Indian or Alaska Native", "Asian", "Native Hawaiian or Pacific Islander", "Other")
    ),
    "Age: Under 18 to 85 or older"
  )
}
if (public_political == 1) {
  covariate_labels <- c(
    # Public affairs
    "Follow national news: Multiple times a day to Never", "Follow international news: Always to Never", 
    str_c(
      "Medium to follow news: ", 
      c("TV", "Print", "Online (excluding social media)", "Social media", "Radio", "Email newsletters", "News app")
    ),
    "Follow government and public affairs: Most of the time to Hardly at all", "Traveled to a developing country: No",
    # Political ideology
    "Liberal to Conservative"
  )
}
if (public_political_social == 1) {
  covariate_labels <- c(
    # Public affairs
    "Follow national news: Multiple times a day to Never", "Follow international news: Always to Never", 
    str_c(
      "Medium to follow news: ", 
      c("TV", "Print", "Online (excluding social media)", "Social media", "Radio", "Email newsletters", "News app")
    ),
    "Follow government and public affairs: Most of the time to Hardly at all", "Traveled to a developing country: No",
    # Political ideology
    "Liberal to Conservative",
    # Social views
    "Trust in political institutions: None to Complete", "People should be more charitable: Agree to Disagree",
    "Religious and worship service attendance: Multiple times a week to Never", "Importance of religion: Extremely to Not at all",
    str_c(
      "Religion: ", 
      c("Protestant", "Christian Orthodox", "Jewish", "Muslim", "Sikh", "Hindu", "Buddhist", "Atheist", "Other")
    )
  )
}
if (public_political_social_charity == 1) {
  covariate_labels <- c(
    # Public affairs
    "Follow national news: Multiple times a day to Never", "Follow international news: Always to Never", 
    str_c(
      "Medium to follow news: ", 
      c("TV", "Print", "Online (excluding social media)", "Social media", "Radio", "Email newsletters", "News app")
    ),
    "Follow government and public affairs: Most of the time to Hardly at all", "Traveled to a developing country: No",
    # Political ideology
    "Liberal to Conservative",
    # Social views
    "Trust in political institutions: None to Complete", "People should be more charitable: Agree to Disagree",
    "Religious and worship service attendance: Multiple times a week to Never", "Importance of religion: Extremely to Not at all",
    str_c(
      "Religion: ", 
      c("Protestant", "Christian Orthodox", "Jewish", "Muslim", "Sikh", "Hindu", "Buddhist", "Atheist", "Other")
    ),
    # Charity and voluntarism
    "Importance of trusing charities: Not at all to Essential", "Trust in charities: None to Complete", "Donation frequency: Weekly to Never",
    "Donated last year: $1-$49 to $10,000 or more", "Volunteered in past 12 months: No", "Volunteer frequency: Weekly to Every few years",
    "History of activism: Extreme to Never", "History of family activism: Extreme to Never", 
    str_c(
      c(
        "Church or religious organization: ", "Sport or recreational organization: ", "Art, music, or educational organization: ",
        "Labor union: ", "Political party: ", "Environmental organization: ", "Professional association: ", 
        "Humanitarian or charitable organization: ", "Consumer organization: ", "Other organization: "
      ), 
      "Member to Not"
    )
  )
}
if (public_political_social_charity_demo == 1) {
  covariate_labels <- c(
    # Public affairs
    "Follow national news: Multiple times a day to Never", "Follow international news: Always to Never", 
    str_c(
      "Medium to follow news: ", 
      c("TV", "Print", "Online (excluding social media)", "Social media", "Radio", "Email newsletters", "News app")
    ),
    "Follow government and public affairs: Most of the time to Hardly at all", "Traveled to a developing country: No",
    # Political ideology
    "Liberal to Conservative",
    # Social views
    "Trust in political institutions: None to Complete", "People should be more charitable: Agree to Disagree",
    "Religious and worship service attendance: Multiple times a week to Never", "Importance of religion: Extremely to Not at all",
    str_c(
      "Religion: ", 
      c("Protestant", "Christian Orthodox", "Jewish", "Muslim", "Sikh", "Hindu", "Buddhist", "Atheist", "Other")
    ),
    # Charity and voluntarism
    "Importance of trusing charities: Not at all to Essential", "Trust in charities: None to Complete", "Donation frequency: Weekly to Never",
    "Donated last year: $1-$49 to $10,000 or more", "Volunteered in past 12 months: No", "Volunteer frequency: Weekly to Every few years",
    "History of activism: Extreme to Never", "History of family activism: Extreme to Never", 
    str_c(
      c(
        "Church or religious organization: ", "Sport or recreational organization: ", "Art, music, or educational organization: ",
        "Labor union: ", "Political party: ", "Environmental organization: ", "Professional association: ", 
        "Humanitarian or charitable organization: ", "Consumer organization: ", "Other organization: "
      ), 
      "Member to Not"
    ),
    # Demographics
    str_c(
      "Gender: ", 
      c("Female", "Transgender", "Prefer not to say", "Other")
    ), 
    str_c(
      "Marital status: ", 
      c("Widowed", "Divorced", "Separated", "Never married")
    ), 
    "Education: Less than high school to Doctorate",
    "Income: Less than $10,000 to $300,000 or more",
    str_c(
      "Race/ethnicity: ", 
      c("White", "Black or African American", "American Indian or Alaska Native", "Asian", "Native Hawaiian or Pacific Islander", "Other")
    ),
    "Age: Under 18 to 85 or older"
  )
}

```

### Combined Results

```{r combined-results, echo = FALSE, warning = FALSE}

if (intercept == 1) {
  draws %>% 
    mutate(
      levels = factor(i, labels = level_labels)
    ) %>%
   # filter(levels == str_c("Issue area: ", c("Environment", "Human rights", "Refugee relief"))) %>%
    ggplot(aes(x = Theta, y = levels)) + 
    geom_density_ridges(scale = 5, height = 3, rel_min_height = 0.01) +
    geom_vline(xintercept = 0, color = "white") +
    labs(y = "Attribute Levels")
}
if (intercept != 1) {
  draws %>% 
    filter(j != 1) %>% 
    mutate(
      levels = factor(i, labels = level_labels),
      covariates = factor(j, labels = covariate_labels)  
    ) %>%
    filter(
      levels == str_c("Organization: ", c("Amnesty International", "Greenpeace", "Oxfam", "Red Cross")),
      covariates == c("Religion: Christian")
# package to help with filtering: stringr
# r4ds chapter 14 (detect matches)
    )
    ggplot(aes(x = Theta, y = covariates)) +
       geom_density_ridges(scale = 5, height = 3, rel_min_height = 0.01) +
       geom_vline(xintercept = 0, color = "white") +
       labs(y = "Covariates") +
       facet_wrap(~ levels, ncol = 7)
}
```

### Relationship With Host Government

We theorize that structural characteristics like an NGO’s host-country political and legal environment can serve as heuristics and shortcuts for donors. Donors who see that an NGO faces general legal trouble abroad will use that knowledge to decide whether or not to donate.

```{r relationship-with-gov, echo = FALSE}
# Plot marginals
if (intercept == 1) {
  draws %>% 
    mutate(
      levels = factor(i, labels = level_labels)
    ) %>%
    filter(levels == str_c("Relationship with host government: ", c("Criticized", "Under crackdown"))) %>% 
    ggplot(aes(x = Theta, y = levels)) + 
    geom_density_ridges(scale = 5, height = 1, rel_min_height = 0.01) +
    geom_vline(xintercept = 0, color = "grey") +
    labs(y = "Attribute Levels")
}
if (intercept != 1) {
  draws %>% 
    filter(j != 1) %>% 
    mutate(
      levels = factor(i, labels = level_labels), 
      covariates = factor(j, labels = covariate_labels)  
    ) %>%
    filter(covariates == c("Follow national news: Multiple times a day to Never", "Follow international news: Always to Never")) %>% 
    ggplot(aes(x = Theta, y = covariates)) +
       geom_density_ridges(scale = 5, height = 3, rel_min_height = 0.01) +
       geom_vline(xintercept = 0, color = "white") +
       labs(y = "Covariates") +
       facet_wrap(~ levels, ncol = 5)
}

```


### Organizational Characteristics

We theorize that non-structural organizational characteristics like managerial practices, funding sources, and issue area also serve as heuristics and influence donation patterns.

#### 1. Managerial Practices

```{r managerial-practices, echo = FALSE}
# Plot marginals
if (intercept == 1) {
  draws %>% 
    mutate(
      levels = factor(i, labels = level_labels)
    ) %>%
    filter(levels == c( "Financial transparency: Yes",
  "Accountability: Yes")) %>% 
    ggplot(aes(x = Theta, y = levels)) + 
    geom_density_ridges(scale = 5, height = 3, rel_min_height = 0.01) +
    geom_vline(xintercept = 0, color = "grey") +
    labs(y = "Attribute Levels")
}
if (intercept != 1) {
  draws %>% 
    filter(j != 1) %>% 
    mutate(
      levels = factor(i, labels = level_labels), 
      covariates = factor(j, labels = covariate_labels)  
    ) %>%
    ggplot(aes(x = Theta, y = covariates)) +
       geom_density_ridges(scale = 5, height = 3, rel_min_height = 0.01) +
       geom_vline(xintercept = 0, color = "white") +
       labs(y = "Covariates") +
       facet_wrap(~ levels, ncol = 5)
}
```

#### 2. Funding Sources
```{r funding_sources, echo = FALSE}
# Plot marginals
if (intercept == 1) {
  draws %>% 
    mutate(
      levels = factor(i, labels = level_labels)
    ) %>%
    filter(levels ==   str_c("Funding sources: ", c("Handful of wealthy private donors", "Government grants"))) %>% 
    ggplot(aes(x = Theta, y = levels)) + 
    geom_density_ridges(scale = 5, height = 3, rel_min_height = 0.01) +
    geom_vline(xintercept = 0, color = "grey") +
    labs(y = "Attribute Levels")
}
if (intercept != 1) {
  draws %>% 
    filter(j != 1) %>% 
    mutate(
      levels = factor(i, labels = level_labels), 
      covariates = factor(j, labels = covariate_labels)  
    ) %>%
    ggplot(aes(x = Theta, y = covariates)) +
       geom_density_ridges(scale = 5, height = 3, rel_min_height = 0.01) +
       geom_vline(xintercept = 0, color = "white") +
       labs(y = "Covariates") +
       facet_wrap(~ levels, ncol = 5)
}
```

#### 3. Issue Areas

```{r issue-areas, echo = FALSE, warning = FALSE}
# Plot marginals
if (intercept == 1) {
  draws %>% 
    mutate(
      levels = factor(i, labels = level_labels)
    ) %>%
    filter(levels == str_c("Issue area: ", c("Environment", "Human rights", "Refugee relief"))) %>% 
    ggplot(aes(x = Theta, y = levels)) + 
    geom_density_ridges(scale = 5, height = 3, rel_min_height = 0.01) +
    geom_vline(xintercept = 0, color = "grey") +
    labs(y = "Attribute Levels")
}
if (intercept != 1) {
  draws %>% 
    filter(j != 1) %>% 
    mutate(
      levels = factor(i, labels = level_labels), 
      covariates = factor(j, labels = covariate_labels)  
    ) %>%
    ggplot(aes(x = Theta, y = covariates)) +
       geom_density_ridges(scale = 5, height = 3, rel_min_height = 0.01) +
       geom_vline(xintercept = 0, color = "white") +
       labs(y = "Covariates") +
       facet_wrap(~ levels, ncol = 5)
}

```
### Organization
```{r organization, echo = FALSE, warning = FALSE}
# Plot marginals
if (intercept == 1) {
  draws %>% 
    mutate(
      levels = factor(i, labels = level_labels)
    ) %>%
    filter(levels == str_c("Organization: ", c("Amnesty International", "Greenpeace", "Oxfam", "Red Cross"))) %>% 
    ggplot(aes(x = Theta, y = levels)) +
    geom_density_ridges(scale = 5, height = 3, rel_min_height = 0.01) +
    geom_vline(xintercept = 0, color = "grey") +
    labs(y = "Attribute Levels")
}
if (intercept != 1) {
  draws %>% 
    filter(j != 1) %>% 
    mutate(
      levels = factor(i, labels = level_labels), 
      covariates = factor(j, labels = covariate_labels)  
    ) %>%
    ggplot(aes(x = Theta, y = covariates)) +
       geom_density_ridges(scale = 5, height = 3, rel_min_height = 0.01) +
       geom_vline(xintercept = 0, color = "white") +
       labs(y = "Covariates") +
       facet_wrap(~ levels, ncol = 5)
}

```


